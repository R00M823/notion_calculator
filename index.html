<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>コンパクト電卓（コピーボタンなし）</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans JP',sans-serif;
    background:#fafafa;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
}
.calculator {
    transform: scale(0.60);
    transform-origin: top center;
    background:#fafafa;
    border:2px solid #594e67;
    border-radius:12px;
    padding:10px;
    width:100%;
    max-width:360px;
    box-shadow:0 2px 12px rgba(89,78,103,0.15);
}
.display {
    background:#594e67;
    border-radius:8px;
    padding:10px 8px;
    margin-bottom:10px;
    text-align:right;
    min-height:70px;
    display:flex;
    flex-direction:column;
    justify-content:flex-end;
    overflow-x:auto;
}
.display-secondary { color:rgba(250,250,250,0.6); font-size:14px; min-height:20px; margin-bottom:4px; font-weight:300; }
.display-main { color:#fafafa; font-size:28px; font-weight:300; word-break:break-all; letter-spacing:0.5px; }

.buttons {
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:6px;
}
button {
    background:#fafafa;
    border:2px solid #594e67;
    border-radius:6px;
    color:#594e67;
    font-size:18px;
    height:45px;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
}
button:hover{ background:#f0f0f0; }
button:active{ background:#e8e8e8; }
.btn-operator { background:#fafafa; }
.btn-clear { background:#594e67; color:#fafafa; border-color:#594e67; }
.btn-clear:hover { background:#6b5d7a; border-color:#6b5d7a; }
.btn-equals { background:#d5b9ca; color:#594e67; border-color:#d5b9ca; }
.btn-equals:hover { background:#dfc7da; border-color:#dfc7da; }
</style>
</head>
<body>
<div class="calculator">
    <div class="display">
        <div class="display-secondary" id="secondaryDisplay"></div>
        <div class="display-main" id="mainDisplay">0</div>
    </div>
    <div class="buttons">
        <button class="btn-clear" onclick="clearAll()">AC</button>
        <button class="btn-operator" onclick="deleteOne()">⌫</button>
        <button class="btn-operator" onclick="inputOperator('%')">%</button>
        <button class="btn-operator" onclick="inputOperator('÷')">÷</button>
        <button onclick="inputNumber('7')">7</button>
        <button onclick="inputNumber('8')">8</button>
        <button onclick="inputNumber('9')">9</button>
        <button class="btn-operator" onclick="inputOperator('×')">×</button>
        <button onclick="inputNumber('4')">4</button>
        <button onclick="inputNumber('5')">5</button>
        <button onclick="inputNumber('6')">6</button>
        <button class="btn-operator" onclick="inputOperator('-')">-</button>
        <button onclick="inputNumber('1')">1</button>
        <button onclick="inputNumber('2')">2</button>
        <button onclick="inputNumber('3')">3</button>
        <button class="btn-operator" onclick="inputOperator('+')">+</button>
        <button onclick="inputNumber('0')">0</button>
        <button onclick="inputNumber('00')">00</button>
        <button onclick="inputNumber('.')">.</button>
        <button class="btn-equals" onclick="calculate()">=</button>
    </div>
</div>

<script>
let currentInput='0', previousInput='', operator='', shouldResetDisplay=false;
const mainDisplay=document.getElementById('mainDisplay');
const secondaryDisplay=document.getElementById('secondaryDisplay');

function updateDisplay(){ 
    mainDisplay.textContent=currentInput; 
    secondaryDisplay.textContent=(previousInput&&operator)?`${previousInput} ${operator}`:''; 
}

function inputNumber(num){ 
    if(shouldResetDisplay){currentInput=num; shouldResetDisplay=false;} 
    else { 
        if(currentInput==='0' && num!=='.') currentInput=num; 
        else if(num==='.'&&currentInput.includes('.')) return; 
        else currentInput+=num;
    } 
    updateDisplay(); 
}

function inputOperator(op){ 
    if(operator && !shouldResetDisplay) calculate(); 
    previousInput=currentInput; 
    operator=op; 
    shouldResetDisplay=true; 
    updateDisplay(); 
}

function calculate(){ 
    if(!operator || !previousInput) return; 
    const prev=parseFloat(previousInput); 
    const current=parseFloat(currentInput); 
    let result; 
    switch(operator){
        case '+': result=prev+current; break; 
        case '-': result=prev-current; break; 
        case '×': result=prev*current; break; 
        case '÷': result=current===0?'Error':prev/current; break; 
        case '%': result=prev*(current/100); break; 
    } 
    if(result==='Error'||isNaN(result)||!isFinite(result)) currentInput='Error'; 
    else currentInput=parseFloat(result.toPrecision(12)).toString(); 
    operator=''; previousInput=''; shouldResetDisplay=true; 
    updateDisplay(); 
}

function clearAll(){currentInput='0';previousInput='';operator='';shouldResetDisplay=false;updateDisplay();}
function deleteOne(){currentInput=(currentInput.length===1||currentInput==='Error')?'0':currentInput.slice(0,-1);updateDisplay();}

// キーボード対応
document.addEventListener('keydown',e=>{
    if((e.key>='0'&&e.key<='9')||e.key=='.') inputNumber(e.key);
    else if(['+','-'].includes(e.key)) inputOperator(e.key);
    else if(e.key=='*') inputOperator('×');
    else if(e.key=='/'){e.preventDefault();inputOperator('÷');}
    else if(e.key=='%') inputOperator('%');
    else if(e.key=='Enter'||e.key=='=') calculate();
    else if(e.key=='Escape') clearAll();
    else if(e.key=='Backspace') deleteOne();
});

updateDisplay();
</script>
</body>
</html>
